<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Global Sensitivity Analysis · HetaSimulator.jl</title><meta name="title" content="Global Sensitivity Analysis · HetaSimulator.jl"/><meta property="og:title" content="Global Sensitivity Analysis · HetaSimulator.jl"/><meta property="twitter:title" content="Global Sensitivity Analysis · HetaSimulator.jl"/><meta name="description" content="Documentation for HetaSimulator.jl."/><meta property="og:description" content="Documentation for HetaSimulator.jl."/><meta property="twitter:description" content="Documentation for HetaSimulator.jl."/><meta property="og:url" content="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/gsa/"/><meta property="twitter:url" content="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/gsa/"/><link rel="canonical" href="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/gsa/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149749027-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-149749027-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HetaSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/overview/">Quick start</a></li><li><a class="tocitem" href="../../basics/distributed/">Parallel simulations</a></li><li><a class="tocitem" href="../../table-formats/scenario/">Scenarios tables</a></li><li><a class="tocitem" href="../../table-formats/measurement/">Measurements tables</a></li><li><a class="tocitem" href="../../table-formats/parameters/">Parameters tables</a></li><li><a class="tocitem" href="../../basics/solvers/">Solver choice</a></li><li><a class="tocitem" href="../../basics/reduction/">Using <code>reduction_func</code> and <code>output_func</code></a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../sim/">Scenario. Simulation</a></li><li><a class="tocitem" href="../mc/">Monte-Carlo. Statistics calculation</a></li><li><a class="tocitem" href="../fit/">Fitting. Measurements</a></li><li class="is-active"><a class="tocitem" href>Global Sensitivity Analysis</a><ul class="internal"><li><a class="tocitem" href="#Working-example"><span>Working example</span></a></li><li><a class="tocitem" href="#GSA-Methods"><span>GSA Methods</span></a></li><li><a class="tocitem" href="#Parallel-setup"><span>Parallel setup</span></a></li></ul></li><li><a class="tocitem" href="../plots/">Plots</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Global Sensitivity Analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Global Sensitivity Analysis</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/hetalang/HetaSimulator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/hetalang/HetaSimulator.jl/blob/master/docs/src/tutorial/gsa.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Global-Sensitivity-Analysis"><a class="docs-heading-anchor" href="#Global-Sensitivity-Analysis">Global Sensitivity Analysis</a><a id="Global-Sensitivity-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Global-Sensitivity-Analysis" title="Permalink"></a></h1><p>This tutorial describes methods of <strong>Global Sensitivity Analysis (GSA)</strong> by using <strong>HetaSimulator</strong> together with <strong>GlobalSensitivity</strong> package. The content is based on <a href="https://docs.sciml.ai/GlobalSensitivity/stable/tutorials/juliacon21/">GlobalSensitivity tutorial</a>. Current version of the tutorial is based on <strong>HetaSimulator v0.7.0</strong> and <strong>GlobalSensitivity v2.7.0</strong></p><p>In order to run GSA we need to install <strong>GlobalSensitivity</strong> package in addition to <strong>HetaSimulator</strong> and <strong>Plots</strong>. We will also use <strong>QuasiMonteCarlo</strong> package for sampling.</p><pre><code class="language-julia hljs">julia&gt; ]
(gsa) pkg&gt; add GlobalSensitivity QuasiMonteCarlo</code></pre><h2 id="Working-example"><a class="docs-heading-anchor" href="#Working-example">Working example</a><a id="Working-example-1"></a><a class="docs-heading-anchor-permalink" href="#Working-example" title="Permalink"></a></h2><p>All GSA methods are illustrated by one-compartment <a href="https://github.com/insysbio/alco">Ethanol PK Model</a>.  Download the following files to your working directory:</p><pre><code class="nohighlight hljs">wget https://raw.githubusercontent.com/insysbio/alco/main/src/index.heta
wget https://raw.githubusercontent.com/insysbio/alco/main/src/mod1.heta
wget https://raw.githubusercontent.com/insysbio/alco/main/src/mod2.heta
wget https://raw.githubusercontent.com/insysbio/alco/main/src/mod3.heta
wget https://raw.githubusercontent.com/insysbio/alco/main/src/qsp-units.heta
wget https://raw.githubusercontent.com/insysbio/alco/main/data-mumenthaler-2000/scenarios.csv</code></pre><p>Load the platform into the Julia environment. You should provide the path to the <code>index.heta</code> file as the first argument to <code>load_platform</code>. We will use the same working directory where the <code>index.heta</code> file is located.</p><pre><code class="language-julia hljs">using HetaSimulator, GlobalSensitivity, Plots

p = load_platform(&quot;.&quot;)

scen = read_scenarios(&quot;scenarios.csv&quot;)
add_scenarios!(p, scen)</code></pre><p>According to Model1 scenario we will study the sensitivity of <em>BrAC</em> observable (breath alcohol concentration) to four parameters <em>(:k_a, :Vd, :Vmax, :Km)</em>.</p><pre><code class="language-julia hljs">scn1 = scenarios(p)[:scn1]
s = sim(scn1)
plot(s, vars=[:BrAC])</code></pre><p><img src="../gsa-fig01.png" alt="plot-default"/></p><p>To run GSA we need to define a function which takes in parameter values and outputs an observable. The observable can be any function of timeseries (e.g. mean, maximum, minimum, AUC, value at a certain timepoint). We can also define vector output to study sensitivity of different observables or an observed variable at different timepoints.</p><p>Let&#39;s have a look at some examples of such functions. </p><pre><code class="language-julia hljs">pnames = [:k_a, :Vd, :Vmax, :Km]
nump = length(pnames)

# Concentration value at t=8 hours
function C8hours_func(params)
  sol = sim(scn1; parameters= pnames .=&gt; params)
  return sol(8.0,:BrAC)
end

# Concentration values at two timepoints t=4,8 hours
function C8hours_func(params)
  sol = sim(scn1; parameters= pnames .=&gt; params)
  return sol.([4.0, 8.0],:BrAC)
end</code></pre><p>In this tutorial we will observe maximum alcohol concentration in the compartment.</p><pre><code class="language-julia hljs">function Cmax_func(params)
  sol = sim(scn1; parameters= pnames .=&gt; params)
  brac = sol.(times(sol),:BrAC)
  return maximum(brac)
end</code></pre><p>Now we define parameters bounds based mean/sd values reported in the original paper <a href="https://doi.org/10.1111/j.1530-0277.2000.tb02103.x">Ethanol Pharmacokinetics in White Women</a>. Parameters bound imply Uniform distribution. Usage of other distributions (Normal, LogNormal, etc) for parameters sampling will be demonstrated later in the tutorial.</p><pre><code class="language-julia hljs">bounds = [[0.01, 0.5], [0.01, 1.], [0.01, 0.5], [0.01, 5.0]]</code></pre><h2 id="GSA-Methods"><a class="docs-heading-anchor" href="#GSA-Methods">GSA Methods</a><a id="GSA-Methods-1"></a><a class="docs-heading-anchor-permalink" href="#GSA-Methods" title="Permalink"></a></h2><h3 id="Regression/Correlation-coefficients-method"><a class="docs-heading-anchor" href="#Regression/Correlation-coefficients-method">Regression/Correlation coefficients method</a><a id="Regression/Correlation-coefficients-method-1"></a><a class="docs-heading-anchor-permalink" href="#Regression/Correlation-coefficients-method" title="Permalink"></a></h3><p><a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/regression/">RegressionGSA method details</a></p><p>The least computationally demanding method to estimate global sensitivities is to compute correlation/regression coefficients. This method is based on the assumption, that the output can be approximated by a linear model of parameters (e.g. <code>BrACmax = a1*k_a + a2∗Vd + a3∗Vmax + a4∗Km</code>). This assumption is reasonable if <strong>the output is monotonic in each of the input parameters</strong>, otherwise the reported coefficients can be missleading. </p><p>The number of samples required by the method should be larger than 2^P (where P is the number of input parameters). 2^P is the bare minimum and a reasonable number of samples for a model of four-five parameters is 1000-5000.</p><p>Usually <strong>Standard Regression Coefficients (SRC)</strong> and <strong>Partial Correlation Coefficients (PCC)</strong> are considered.</p><pre><code class="language-julia hljs">nsamples = 1000
reg_sens = GlobalSensitivity.gsa(Cmax_func, RegressionGSA(true), bounds, samples = nsamples)

p = plot(layout=(2,1), size=(400,600))
heatmap!(p[1],
    reg_sens.partial_correlation, fc =cgrad([:blue, :orange]),
    yticks=false, xticks = (1:nump, String.(pnames)),
    title = &quot;Partial correlation&quot;)

heatmap!(p[2],
    reg_sens.standard_regression,fc =cgrad([:blue, :orange]),
    yticks=false, xticks = (1:nump, String.(pnames)),
    title = &quot;Standard correlation&quot;)
p</code></pre><p><img src="../gsa-fig02.png" alt="plot-regression"/></p><p><strong>(Note!)</strong> Regression-based GSA can also be applied to the results of multiple simulations provided to <code>gsa()</code> function as <code>Matrices</code>. See <a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/regression/">GlobalSensitivity docs</a>. This allows us generate parameters in advance from pre-defined Distributions.</p><pre><code class="language-julia hljs"># Matrix of input parameters
X = zeros(length(pnames), nsamples)
X[1,:] .= rand(LogNormal(-3.08, 0.77), nsamples) # k_a
X[2,:] .= rand(Uniform(0.01, 1.), nsamples) # Vd
X[3,:] .= rand(Uniform(0.01, 0.5), nsamples) # Vmax
X[4,:] .= rand(LogNormal(0.46, 0.49), nsamples) # Km

# output max concentration values
Y = [Cmax_func(X[:, i]) for i in 1:size(X,2)]&#39;

reg_sens = GlobalSensitivity.gsa(X, Y, RegressionGSA(true))</code></pre><h3 id="Sobol-(and-eFAST)-method"><a class="docs-heading-anchor" href="#Sobol-(and-eFAST)-method">Sobol (and eFAST) method</a><a id="Sobol-(and-eFAST)-method-1"></a><a class="docs-heading-anchor-permalink" href="#Sobol-(and-eFAST)-method" title="Permalink"></a></h3><p><a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/sobol/">Sobol method details</a></p><p>Sobol method is the GSA method of variance decomposition based on mathematical result by I.M. Sobol. Variance of the output is decomposed into contributions from each parameter and their interactions. Two indices are used to measure these contributions. The contribution of each parameter is represented by <strong>first-order index</strong> and the contribution of the parameter together with all its interactions with other parameters is represented by <strong>total-order index</strong>. </p><p>The requirement for the number of samples is the same as for Correlatin/Regression coefficients method: <strong>The number of samples required by the method should be larger than 2^P (where P is the number of input parameters).</strong></p><pre><code class="language-julia hljs">nsamples = 1000
sobol_sens1 = GlobalSensitivity.gsa(Cmax_func, Sobol(), bounds, samples = nsamples)

p = plot(layout=(2,1), size=(400,600), xticks = (1:nump, String.(pnames)))
bar!(p[1], 1:nump, sobol_sens1.S1, title = &quot;Sobol First order indeces&quot;, label=false)
bar!(p[2], 1:nump, sobol_sens1.ST, title = &quot;Sobol Total order indeces&quot;, label=false)
p</code></pre><p><img src="../gsa-fig03.png" alt="plot-sobol1"/></p><p><strong>(Note 1 !)</strong> It is recommended to use low-discrepancy sequence instead of a pure Monte-Carlo to effectively sample the search space . One can choose <code>SobolSample()</code>, <code>LatinHypercubeSample()</code>, <code>HaltonSample()</code> or other quasi-Monte Carlo samplers from <code>QuasiMonteCarlo</code> package. </p><pre><code class="language-julia hljs">using QuasiMonteCarlo

lb = [b[1] for b in bounds]
ub = [b[2] for b in bounds]
sampler = SobolSample()
A,B = QuasiMonteCarlo.generate_design_matrices(nsamples,lb,ub,sampler)

sobol_sens2 = GlobalSensitivity.gsa(Cmax_func, Sobol(), A, B)</code></pre><p><strong>(Note 2 !)</strong> To ensure the convergence of Sobol indices and choose reasonable sample size it is useful to set different sample sizes and monitor (plot) how the indices&#39; values stabilize with the increase of sample size. </p><p><strong>(Note 3 !)</strong> As of GlobalSensitivity@v2.7.0 <code>Sobol()</code> implementation supports  Uniform input ranges and not parameters&#39; distributions. If you prefer to input parameters&#39; distributions you can choose <code>eFAST()</code>, which is based on <code>Sobol()</code> method. Please refer to the <a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/efast/">eFAST docs</a> for detailed example.</p><h3 id="Morris-method-(Elementary-effects-method)"><a class="docs-heading-anchor" href="#Morris-method-(Elementary-effects-method)">Morris method (Elementary effects method)</a><a id="Morris-method-(Elementary-effects-method)-1"></a><a class="docs-heading-anchor-permalink" href="#Morris-method-(Elementary-effects-method)" title="Permalink"></a></h3><p><a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/morris/">Morris method details</a></p><p>Morris method estimates parameters&#39; contribution to the output be computing individual &quot;elementary effects&quot; (EE), which are local sensitivities at different points in the parameters space. The method runs multiple trajectories through the grid of points in parameter space, computes EEs and outputs mean and std of EE per parameter. The sensitivities are calculated per parameter, so the method doesn&#39;t take into account interactions between parameters. Morris method doesn&#39;t have a strong mathematical foundation (as Sobol method). Due to its simplicity, it is commonly used as a pre-scan method with all the input parameters of interest. Parameters identified as noninfluential can be then fixed to run computationally demanding but more reliable variance-based methods (<code>Sobol()</code>, <code>eFAST()</code>)</p><p>The requirement for the number of samples is the same as for Correlatin/Regression coefficients method: <strong>The number of samples required by the method should be larger than 2^P (where P is the number of input parameters).</strong></p><p>The number of estimated points in the parameter space is controlled by <code>total_num_trajectory</code> and <code>num_trajectory</code> arguments. See <a href="https://docs.sciml.ai/GlobalSensitivity/stable/methods/morris/">Morris method docs</a> for details. </p><pre><code class="language-julia hljs">morris_sens = GlobalSensitivity.gsa(Cmax_func, Morris(total_num_trajectory=5000,num_trajectory=600), bounds)

bar(1:nump, morris_sens.means_star[1,:], title = &quot;Morris method&quot;, label=false)</code></pre><p><img src="../gsa-fig04.png" alt="plot-morris"/></p><p><strong>(Note 1 !)</strong> Morris method also outputs std of EE per parameter: <code>morris_sens.variances</code>. High std reported by Morris method can be a marker of parameters interaction or high nonlinearity between the parameters and the output. </p><p><strong>(Note 2 !)</strong> As in <code>Sobol()</code> method it useful to set different number of trajectories and monitor how the mean values stabilize with the increase of sample size. </p><p><strong>(Note 3 !)</strong> As of GlobalSensitivity@v2.7.0 <code>Morris()</code> implementation doesn&#39;t support <code>generate_design_matrices</code> interface (see Sobol method notes), so only default sampling scheme (Monte-Carlo) can be used.</p><h2 id="Parallel-setup"><a class="docs-heading-anchor" href="#Parallel-setup">Parallel setup</a><a id="Parallel-setup-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-setup" title="Permalink"></a></h2><p>It is natural to speed-up GSA methods (e.g. Sobol method) by running simulations in parallel. To do so we need to rewrite <code>Cmax_func</code> and use <code>batch</code> keyword argument in the <code>gsa()</code> function.</p><pre><code class="language-julia hljs">function Cmax_batch_func(params_batch)
    batch_size = size(params_batch,2)
    sol = mc(scn1, pnames .=&gt; [params_batch[i,:] for i in eachindex(pnames)], batch_size; parallel_type=EnsembleDistributed())
    
    out = zeros(batch_size)
    for i in eachindex(out)
        brac = sol[i].(times(sol[i]),:BrAC)
        out[i] = maximum(brac)
    end
    return out
  end

  sobol_sens = GlobalSensitivity.gsa(Cmax_batch_func, Sobol(), A, B, batch=true)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../fit/">« Fitting. Measurements</a><a class="docs-footer-nextpage" href="../plots/">Plots »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.13.0 on <span class="colophon-date" title="Monday 30 June 2025 15:08">Monday 30 June 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
