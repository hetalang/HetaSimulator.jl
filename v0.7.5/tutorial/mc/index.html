<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Monte-Carlo. Statistics calculation · HetaSimulator.jl</title><meta name="title" content="Monte-Carlo. Statistics calculation · HetaSimulator.jl"/><meta property="og:title" content="Monte-Carlo. Statistics calculation · HetaSimulator.jl"/><meta property="twitter:title" content="Monte-Carlo. Statistics calculation · HetaSimulator.jl"/><meta name="description" content="Documentation for HetaSimulator.jl."/><meta property="og:description" content="Documentation for HetaSimulator.jl."/><meta property="twitter:description" content="Documentation for HetaSimulator.jl."/><meta property="og:url" content="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/mc/"/><meta property="twitter:url" content="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/mc/"/><link rel="canonical" href="https://hetalang.github.io/HetaSimulator.jl/stable/tutorial/mc/"/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-149749027-1"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-149749027-1', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">HetaSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/overview/">Quick start</a></li><li><a class="tocitem" href="../../basics/distributed/">Parallel simulations</a></li><li><a class="tocitem" href="../../table-formats/scenario/">Scenarios tables</a></li><li><a class="tocitem" href="../../table-formats/measurement/">Measurements tables</a></li><li><a class="tocitem" href="../../table-formats/parameters/">Parameters tables</a></li><li><a class="tocitem" href="../../basics/solvers/">Solver choice</a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../sim/">Scenario. Simulation</a></li><li class="is-active"><a class="tocitem" href>Monte-Carlo. Statistics calculation</a><ul class="internal"><li><a class="tocitem" href="#Working-example"><span>Working example</span></a></li><li><a class="tocitem" href="#Single-scenario-simulations"><span>Single scenario simulations</span></a></li><li><a class="tocitem" href="#Multiple-scenarios-simulations"><span>Multiple scenarios simulations</span></a></li><li><a class="tocitem" href="#Monte-Carlo-simulations-of-the-whole-platform"><span>Monte-Carlo simulations of the whole platform</span></a></li><li><a class="tocitem" href="#Using-pre-generated-parameters-set"><span>Using pre-generated parameters set</span></a></li><li><a class="tocitem" href="#Monte-Carlo-statistics"><span>Monte-Carlo statistics</span></a></li><li><a class="tocitem" href="#Final-remarks"><span>Final remarks</span></a></li></ul></li><li><a class="tocitem" href="../fit/">Fitting. Measurements</a></li><li><a class="tocitem" href="../gsa/">Global Sensitivity Analysis</a></li><li><a class="tocitem" href="../plots/">Plots</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Monte-Carlo. Statistics calculation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Monte-Carlo. Statistics calculation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/hetalang/HetaSimulator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/hetalang/HetaSimulator.jl/blob/master/docs/src/tutorial/mc.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Monte-Carlo.-Statistics-calculation"><a class="docs-heading-anchor" href="#Monte-Carlo.-Statistics-calculation">Monte-Carlo. Statistics calculation</a><a id="Monte-Carlo.-Statistics-calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo.-Statistics-calculation" title="Permalink"></a></h1><p>Monte-Carlo simulations in HetaSimulator can be run using the <a href="../../api/#HetaSimulator.mc-Tuple{Union{Vector{Pair{Symbol, Scenario}}, Vector{Scenario}, Platform, Scenario}, DataFrame}"><code>mc</code></a> method. It can be applied to: a single scenario, series of scenarios and the whole platform.</p><h2 id="Working-example"><a class="docs-heading-anchor" href="#Working-example">Working example</a><a id="Working-example-1"></a><a class="docs-heading-anchor-permalink" href="#Working-example" title="Permalink"></a></h2><p>This example uses the <code>heta</code> model, which can be downloaded here: <a href="../mc-files/index.heta">index.heta</a></p><pre><code class="language-julia hljs">comp1 @Compartment .= 1.1;
comp2 @Compartment .= 2.2;

a @Species { compartment: comp1, output: true } .= 10;
b @Species { compartment: comp1, output: true } .= 0;
c @Species { compartment: comp1, output: true } .= 1;
d @Species { compartment: comp2 } .= 0;

r1 @Reaction { actors: a =&gt; b };
r2 @Reaction { actors: b + c &lt;=&gt; d };
r1 := k1 * a;
r2 := k2 * b * c - k3 * d;

k1 @Const = 1e-3;
k2 @Const = 1e-4;
k3 @const = 2.2e-2;

// test
sw1 @TimeSwitcher {start: 50};
a [sw1]= a + 1;

//sw2 @TimeSwitcher {start: 100};
//b [sw2]= 0;

//sw3 @DSwitcher {trigger: a &lt;= 9};
//a [sw3]= a + 2;

//ss1 @StopSwitcher {trigger: t &gt; 10};</code></pre><p>Download the file or create <strong>index.heta</strong> with VSCode in the working directory.</p><p>Load the platform into the Julia environment. You should provide the path to the modeling platform as the first argument to <code>load_platform</code>.</p><pre><code class="language-julia hljs">using HetaSimulator, Plots
using Distributed # to use parallel simulations

platform = load_platform(&quot;.&quot;)
model = platform.models[:nameless]</code></pre><pre><code class="nohighlight hljs">Model contains 3 constant(s), 8 record(s), 1 switcher(s).
   Constants (model-level parameters): k1, k2, k3
   Records (observables): comp1, comp2, a, b, c, d, r1, r2
   Switchers (events): sw1</code></pre><h2 id="Single-scenario-simulations"><a class="docs-heading-anchor" href="#Single-scenario-simulations">Single scenario simulations</a><a id="Single-scenario-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Single-scenario-simulations" title="Permalink"></a></h2><p>Create two scenarios such as: </p><pre><code class="language-julia hljs">mcscn1 = Scenario(
  model,
  (0., 200.);
  parameters = [:k1=&gt;0.01],
  saveat = [50., 80., 150.]
)

mcscn2 = Scenario(
  model,
  (0., 200.);
  parameters = [:k1=&gt;0.02],
  saveat = [50., 100., 200.]
)</code></pre><p>The scenarios updates the value of <code>k1</code> parameter (<code>@Const</code> component in model). The <code>observables</code> vector is not set, so outputs will be the default set of variables: <code>a</code>, <code>b</code>, <code>c</code>.</p><p>Monte-Carlo simulations <code>mc</code> can be applied to a single scenario <code>mcscn1</code>. The second argument in <code>mc</code> is the distribution of the selected independent parameters. The format of the argument is the vector of pairs where the first element is parameter id and the second one is the distribution. You can also set a <code>Float64</code> value for a parameter here and this rewrites the value in the model and leaves the parameter value fixed. The third argument is the number of Monte-Carlo simulations to run.</p><pre><code class="language-julia hljs">mcsim1 = mc(mcscn1, [:k1=&gt;Uniform(1e-3,1e-2), :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Normal(1e-4,1e-5)], 100)</code></pre><p>We can limit the variables for visualization with <code>vars</code> argument in <code>plot</code>.</p><pre><code class="language-julia hljs">plot(mcsim1, vars=[:b])</code></pre><p><img src="../mc-fig01.png" alt="mc-fig01"/></p><p>Monte-Carlo results can also be transformed into <code>DataFrame</code>.</p><pre><code class="language-julia hljs">DataFrame(mcsim1, vars=[:a, :b])</code></pre><h2 id="Multiple-scenarios-simulations"><a class="docs-heading-anchor" href="#Multiple-scenarios-simulations">Multiple scenarios simulations</a><a id="Multiple-scenarios-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-scenarios-simulations" title="Permalink"></a></h2><p>In the same way as it was shown for <code>sim</code> method we can run <code>mc</code> with multiple scenarios. The returned object will be of type <code>Vector{Pair{Symbol,MCResult}}</code>.</p><pre><code class="language-julia hljs">mcsim2 = mc(
    [:mc1=&gt;mcscn1,:mc2=&gt;mcscn2],
    [:k1=&gt;0.01, :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Uniform(1e-4,1e-2)],
    100
  )
plot(mcsim2)</code></pre><p><img src="../mc-fig02.png" alt="mc-fig02"/></p><p>Results of MC simulations can be transformed into <code>DataFrame</code> too.</p><pre><code class="language-julia hljs">mc_df2 = DataFrame(mcsim2)</code></pre><h2 id="Monte-Carlo-simulations-of-the-whole-platform"><a class="docs-heading-anchor" href="#Monte-Carlo-simulations-of-the-whole-platform">Monte-Carlo simulations of the whole platform</a><a id="Monte-Carlo-simulations-of-the-whole-platform-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo-simulations-of-the-whole-platform" title="Permalink"></a></h2><p>Simulation scenarios for <code>mc</code> can also be loaded from tabular files.</p><p>Create <strong>scenarios.csv</strong> file in the same directory and fill it with the data or download it here: <a href="../mc-files/scenarios.csv">scenarios.csv</a></p><p><img src="../mc-fig03.png" alt="mc-fig03"/></p><p>Load it as a scenarios table.</p><pre><code class="language-julia hljs">scn_csv = read_scenarios(&quot;./scenarios.csv&quot;)
add_scenarios!(platform, scn_csv)</code></pre><p>Apply <code>mc</code> to the platform to run MC simulations with all <code>Scenario</code>s in the platform.</p><pre><code class="language-julia hljs">mcplat = mc(
    platform,
    [:k1=&gt;0.01, :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Uniform(1e-4,1e-2)],
    100
  )
plot(mcplat)</code></pre><p><img src="../mc-fig04.png" alt="mc-fig04"/></p><h2 id="Using-pre-generated-parameters-set"><a class="docs-heading-anchor" href="#Using-pre-generated-parameters-set">Using pre-generated parameters set</a><a id="Using-pre-generated-parameters-set-1"></a><a class="docs-heading-anchor-permalink" href="#Using-pre-generated-parameters-set" title="Permalink"></a></h2><p>In many practical cases it will be useful to pre-generate parameters values and run simulations in two steps. To do it one needs to</p><ol><li>Create a DataFrame with parameters values</li><li>Use it as the second argument in <code>mc</code> method.</li></ol><p>Parameter sets can be created using the <code>DataFrame</code> constructor.</p><pre><code class="language-julia hljs">mcvecs0 = DataFrame(k1=0.01, k2=rand(Normal(1e-3,1e-4), 50), k3=rand(Uniform(1e-4,1e-2), 50))</code></pre><p>Or parameters values can be loaded from CSV file.</p><p>The file can be downloaded here: <a href="../mc-files/params.csv">params.csv</a></p><p><img src="../mc-fig05.png" alt="mc-fig05"/></p><pre><code class="language-julia hljs">mcvecs = read_mcvecs(&quot;./params.csv&quot;)</code></pre><pre><code class="nohighlight hljs">100×3 DataFrame
 Row │ k1          k2           k3
     │ Float64     Float64      Float64     
─────┼──────────────────────────────────────
   1 │ 0.00904655  0.00109494   0.00938817
   2 │ 0.00342413  0.000952441  0.00274764
  ⋮  │     ⋮            ⋮            ⋮
 100 │ 0.00318838  0.00106162   0.000996487
                             97 rows omitted</code></pre><p>This DataFrame can be used as the second argument in <code>mc</code>.</p><pre><code class="language-julia hljs">mcv1 = mc(
  mcscn1,
  mcvecs
)
plot(mc1)</code></pre><p><img src="../mc-fig06.png" alt="mc-fig06"/></p><h2 id="Monte-Carlo-statistics"><a class="docs-heading-anchor" href="#Monte-Carlo-statistics">Monte-Carlo statistics</a><a id="Monte-Carlo-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo-statistics" title="Permalink"></a></h2><p>Monte-Carlo results can be used to calculate some characteristics which will be called &quot;statistics&quot;.</p><p>There are some standard methods taken from <code>SciMLBase.jl</code> (see more here <a href="https://docs.sciml.ai/DiffEqDocs/stable/features/ensemble/#Example-4:-Using-the-Analysis-Tools">https://docs.sciml.ai/DiffEqDocs/stable/features/ensemble/#Example-4:-Using-the-Analysis-Tools</a>).</p><p>See below several methods that calculate statistics for some particular time point.</p><pre><code class="language-julia hljs">timestep_mean(mcv1,2)
timepoint_mean(mcv1,80)

# median
timestep_median(mcv1,2)
timepoint_median(mcv1,80)

# meanvar
timestep_meanvar(mcv1,2)
timepoint_meanvar(mcv1,80)

# meancov
timestep_meancov(mcv1,2,3)
timepoint_meancov(mcv1,80.,150.)

# meancor
timestep_meancor(mcv1,2,3)
timepoint_meancor(mcv1,80.,150.)

# quantile
timestep_quantile(mcv1,0.95,2)
timepoint_quantile(mcv1,0.95,80.)</code></pre><p>The next methods calculate statistics for all time points.</p><pre><code class="language-julia hljs">timeseries_steps_mean(mcv1) # Computes the mean at each time step
timeseries_steps_median(mcv1) # Computes the median at each time step
timeseries_steps_quantile(mcv1,0.95) # Computes the quantile q at each time step
timeseries_steps_meanvar(mcv1) # Computes the mean and variance at each time step
timeseries_steps_meancov(mcv1) # Computes the covariance matrix and means at each time step
timeseries_steps_meancor(mcv1) # Computes the correlation matrix and means at each time step</code></pre><p>And finally there is an example of statistics summary and visualization.</p><pre><code class="language-julia hljs"># Ensemble Summary
ens = EnsembleSummary(mcsim1; quantiles=[0.05,0.95])
plot(ens)</code></pre><p><img src="../mc-fig07.png" alt="mc-fig07"/></p><h2 id="Final-remarks"><a class="docs-heading-anchor" href="#Final-remarks">Final remarks</a><a id="Final-remarks-1"></a><a class="docs-heading-anchor-permalink" href="#Final-remarks" title="Permalink"></a></h2><ul><li>If you are going to use &quot;statistics&quot; methods you should always set <code>saveat</code> argument in <code>Scenario</code>.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sim/">« Scenario. Simulation</a><a class="docs-footer-nextpage" href="../fit/">Fitting. Measurements »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.2 on <span class="colophon-date" title="Wednesday 14 May 2025 15:07">Wednesday 14 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
