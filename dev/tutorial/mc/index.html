<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Monte-Carlo. Statistics calculation · HetaSimulator Docs</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-149749027-1', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link rel="canonical" href="https://hetalang.github.io/HetaSimulator.jl/dev/tutorial/mc/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">HetaSimulator Docs</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../../basics/overview/">Quick start</a></li><li><a class="tocitem" href="../../basics/distributed/">Parallel simulations</a></li><li><a class="tocitem" href="../../table-formats/scenario/">Scenarios tables</a></li><li><a class="tocitem" href="../../table-formats/measurement/">Measurements tables</a></li><li><a class="tocitem" href="../../table-formats/parameters/">Parameters tables</a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../sim/">Scenario. Simulation</a></li><li class="is-active"><a class="tocitem" href>Monte-Carlo. Statistics calculation</a><ul class="internal"><li><a class="tocitem" href="#Working-example"><span>Working example</span></a></li><li><a class="tocitem" href="#Single-scenario-simulations"><span>Single scenario simulations</span></a></li><li><a class="tocitem" href="#Multiple-scenarios-simulations"><span>Multiple scenarios simulations</span></a></li><li><a class="tocitem" href="#Monte-Carlo-for-whole-platform"><span>Monte-Carlo for whole platform</span></a></li><li><a class="tocitem" href="#Using-pre-generated-parameter-set"><span>Using pre-generated parameter set</span></a></li><li><a class="tocitem" href="#Monte-Carlo-statistics"><span>Monte-Carlo statistics</span></a></li><li><a class="tocitem" href="#Final-remarks"><span>Final remarks</span></a></li></ul></li><li><a class="tocitem" href="../fit/">Fitting. Measurements</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorial</a></li><li class="is-active"><a href>Monte-Carlo. Statistics calculation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Monte-Carlo. Statistics calculation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/hetalang/HetaSimulator.jl/blob/master/docs/src/tutorial/mc.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Monte-Carlo.-Statistics-calculation"><a class="docs-heading-anchor" href="#Monte-Carlo.-Statistics-calculation">Monte-Carlo. Statistics calculation</a><a id="Monte-Carlo.-Statistics-calculation-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo.-Statistics-calculation" title="Permalink"></a></h1><p>Monte-Carlo simulations in HetaSimulator can be run using the <a href="../../api/#HetaSimulator.mc-Tuple{Union{Vector{Pair{Symbol, Scenario}}, Vector{Scenario}, Platform, Scenario}, DataFrame}"><code>mc</code></a> method. It can be applied for: single scenario, series of scenarios and the whole platform.</p><p>_Before start be sure you have the latest <strong>HetaSimulator.jl</strong> version. If you don&#39;t have it reinstall using the Julia environment.</p><pre><code class="language-julia">] # switch to Pkg mode
add HetaSimulator</code></pre><h2 id="Working-example"><a class="docs-heading-anchor" href="#Working-example">Working example</a><a id="Working-example-1"></a><a class="docs-heading-anchor-permalink" href="#Working-example" title="Permalink"></a></h2><p>This lesson uses the following modeling code.</p><p>File can be downloaded here: <a href="../mc-files/index.heta">index.heta</a></p><pre><code class="language-julia">comp1 @Compartment .= 1.1;
comp2 @Compartment .= 2.2;

a @Species { compartment: comp1, output: true } .= 10;
b @Species { compartment: comp1, output: true } .= 0;
c @Species { compartment: comp1, output: true } .= 1;
d @Species { compartment: comp2 } .= 0;

r1 @Reaction { actors: a =&gt; b };
r2 @Reaction { actors: b + c &lt;=&gt; d };
r1 := k1 * a;
r2 := k2 * b * c - k3 * d;

k1 @Const = 1e-3;
k2 @Const = 1e-4;
k3 @const = 2.2e-2;

// test
sw1 @TimeSwitcher {start: 50};
a [sw1]= a + 1;

//sw2 @TimeSwitcher {start: 100};
//b [sw2]= 0;

//sw3 @DSwitcher {trigger: a &lt;= 9};
//a [sw3]= a + 2;

//ss1 @StopSwitcher {trigger: t &gt; 10};</code></pre><p>Create <strong>index.heta</strong> file with the contend and place it into the working directory.</p><p>Load the platform into the Julia environment. You should clarify the path to the modeling platform as the first argument.</p><pre><code class="language-julia">using HetaSimulator, Plots
using Distributed # to use parallel simulations

platform = load_platform(&quot;.&quot;)
model = platform.models[:nameless]</code></pre><pre><code class="language-none">Model contains 3 constant(s), 8 record(s), 1 switcher(s).
   Constants: k1, k2, k3
   Records: comp1, comp2, a, b, c, d, r1, r2
   Switchers (events): sw1</code></pre><h2 id="Single-scenario-simulations"><a class="docs-heading-anchor" href="#Single-scenario-simulations">Single scenario simulations</a><a id="Single-scenario-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Single-scenario-simulations" title="Permalink"></a></h2><p>Create two scenarios as follows. </p><pre><code class="language-julia">mcscn1 = Scenario(
  model,
  (0., 200.);
  parameters = [:k1=&gt;0.01]
)

mcscn2 = Scenario(
  model,
  (0., 200.);
  parameters = [:k1=&gt;0.02]
)</code></pre><p>The scenarios updates the parameter <code>k1</code> value (<code>@Const</code> component in model). The <code>observables</code> vector is not set, so outputs will be taken from default set: <code>a</code>, <code>b</code>, <code>c</code>.</p><p>Monte-Carlo simulations <code>mc</code> can be used to simulate single scenario <code>mcscn1</code> and plot results. The second argument in <code>mc</code> is the distribution for all independent parameters. The format of the argument is the vector of pairs where the first element is parameter id and the second one is the distribution rule. You can also set the <code>Float64</code> value of a parameter here and this rewrites the value in a model without putting variability. The third argument is the number of Monte-Carlo simulations to do.</p><pre><code class="language-julia">mcsim1 = mc(mcscn1, [:k1=&gt;Uniform(1e-3,1e-2), :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Normal(1e-4,1e-5)], 100,  saveat = [50., 80., 150.])</code></pre><p>We can limit the components for visualization with <code>vars</code> argument in <code>plot</code>.</p><pre><code class="language-julia">plot(mcsim1, vars=[:b])</code></pre><p><img src="../mc-fig01.png" alt="mc-fig01"/></p><p>Monte-Carlo results can also be transformed into DataFrame.</p><pre><code class="language-julia">DataFrame(mcsim1, vars=[:a, :b])</code></pre><h2 id="Multiple-scenarios-simulations"><a class="docs-heading-anchor" href="#Multiple-scenarios-simulations">Multiple scenarios simulations</a><a id="Multiple-scenarios-simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Multiple-scenarios-simulations" title="Permalink"></a></h2><p>In the same way as it was done for <code>sim</code> method we can also run <code>mc</code> for multiple scenarios. The returned object will be of type <code>MCResult</code>.</p><pre><code class="language-julia">mcsim2 = mc(
    [:mc1=&gt;mcscn1,:mc2=&gt;mcscn2],
    [:k1=&gt;0.01, :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Uniform(1e-4,1e-2)],
    100
  )
plot(mcsim2)</code></pre><p><img src="../mc-fig02.png" alt="mc-fig02"/></p><p>Results of simulations can be transformed into <code>DataFrame</code> too.</p><pre><code class="language-julia">mc_df2 = DataFrame(mcsim2)</code></pre><h2 id="Monte-Carlo-for-whole-platform"><a class="docs-heading-anchor" href="#Monte-Carlo-for-whole-platform">Monte-Carlo for whole platform</a><a id="Monte-Carlo-for-whole-platform-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo-for-whole-platform" title="Permalink"></a></h2><p>Scenarios for <code>mc</code> can also be loaded from CSV file.</p><p>Create file <strong>scenarios.csv</strong> in the same directory and fill it with the data.</p><p><img src="../mc-fig03.png" alt="mc-fig03"/></p><p>File can be downloaded here: <a href="../mc-files/scenarios.csv">scenarios.csv</a></p><p>Load it as a scenarios table.</p><pre><code class="language-julia">scn_csv = read_scenarios(&quot;./scenarios.csv&quot;)
add_scenarios!(platform, scn_csv)</code></pre><p>Apply <code>mc</code> for the platform which is the same as simulations for all <code>Scenario</code>s of the platform.</p><pre><code class="language-julia">mcplat = mc(
    platform,
    [:k1=&gt;0.01, :k2=&gt;Normal(1e-3,1e-4), :k3=&gt;Uniform(1e-4,1e-2)],
    100
  )
plot(mcplat)</code></pre><p><img src="../mc-fig04.png" alt="mc-fig04"/></p><h2 id="Using-pre-generated-parameter-set"><a class="docs-heading-anchor" href="#Using-pre-generated-parameter-set">Using pre-generated parameter set</a><a id="Using-pre-generated-parameter-set-1"></a><a class="docs-heading-anchor-permalink" href="#Using-pre-generated-parameter-set" title="Permalink"></a></h2><p>In many practical cases it will be more useful to generate random parameters and run simulations in two steps. It is possible to do (1) creating DataFrame with parameter sets and (2) using it as an argument for <code>mc</code> method.</p><p>Parameter set can be created using the base <code>DataFrame</code> constructor.</p><pre><code class="language-julia">mcvecs0 = DataFrame(k1=0.01, k2=rand(Normal(1e-3,1e-4), 50), k3=rand(Uniform(1e-4,1e-2), 50))</code></pre><p>Or it can be loaded from CSV file.</p><p>File can be downloaded here: <a href="../mc-files/params.csv">params.csv</a></p><p><img src="../mc-fig05.png" alt="mc-fig05"/></p><pre><code class="language-julia">mcvecs = read_mcvecs(&quot;./params.csv&quot;)</code></pre><pre><code class="language-none">100×3 DataFrame
 Row │ k1          k2           k3
     │ Float64     Float64      Float64     
─────┼──────────────────────────────────────
   1 │ 0.00904655  0.00109494   0.00938817
   2 │ 0.00342413  0.000952441  0.00274764
  ⋮  │     ⋮            ⋮            ⋮
 100 │ 0.00318838  0.00106162   0.000996487
                             97 rows omitted</code></pre><p>This DataFrame can be used as the second argument in <code>mc</code>.</p><pre><code class="language-julia">mcv1 = mc(
  mcscn1,
  mcvecs
)
plot(mc1)</code></pre><p><img src="../mc-fig06.png" alt="mc-fig06"/></p><h2 id="Monte-Carlo-statistics"><a class="docs-heading-anchor" href="#Monte-Carlo-statistics">Monte-Carlo statistics</a><a id="Monte-Carlo-statistics-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo-statistics" title="Permalink"></a></h2><p>Monte-Carlo results can be used to calculate some characteristics which will be called &quot;statistics&quot;.</p><p>There are some standard methods borrowed from <code>DiffEq.jl</code> package (see more here <a href="https://diffeq.sciml.ai/stable/features/ensemble/#Summary-Statistics">https://diffeq.sciml.ai/stable/features/ensemble/#Summary-Statistics</a>).</p><p>See below several methods that calculates statistics for some particular time point.</p><pre><code class="language-julia">timestep_mean(mcv1,2)
timepoint_mean(mcv1,80)

# median
timestep_median(mcv1,2)
timepoint_median(mcv1,80)

# meanvar
timestep_meanvar(mcv1,2)
timepoint_meanvar(mcv1,80)

# meancov
timestep_meancov(mcv1,2,3)
timepoint_meancov(mcv1,80.,150.)

# meancor
timestep_meancor(mcv1,2,3)
timepoint_meancor(mcv1,80.,150.)

# quantile
timestep_quantile(mcv1,0.95,2)
timepoint_quantile(mcv1,0.95,80.)</code></pre><p>The next methods calculates statistics for all time points.</p><pre><code class="language-julia">timeseries_steps_mean(mcv1) # Computes the mean at each time step
timeseries_steps_median(mcv1) # Computes the median at each time step
timeseries_steps_quantile(mcv1,0.95) # Computes the quantile q at each time step
timeseries_steps_meanvar(mcv1) # Computes the mean and variance at each time step
timeseries_steps_meancov(mcv1) # Computes the covariance matrix and means at each time step
timeseries_steps_meancor(mcv1) # Computes the correlation matrix and means at each time step</code></pre><p>And finally there is an example of statistics summary and visualization.</p><pre><code class="language-julia"># Ensemble Summary
ens = EnsembleSummary(mcsim1;quantiles=[0.05,0.95])
plot(ens)</code></pre><p><img src="../mc-fig07.png" alt="mc-fig07"/></p><h2 id="Final-remarks"><a class="docs-heading-anchor" href="#Final-remarks">Final remarks</a><a id="Final-remarks-1"></a><a class="docs-heading-anchor-permalink" href="#Final-remarks" title="Permalink"></a></h2><ol><li><p>If you are going to use &quot;statistics&quot; methods you should always set the <code>saveat</code> argument in <code>mc</code>.</p></li><li><p>If you run <code>mc</code> with parameters generated online, i.e. without pre-generated set currently you cannot obtain the input parameters values directly.  This will be fixed in one of future releases. Before that if you need them use pre-generation.</p></li></ol></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sim/">« Scenario. Simulation</a><a class="docs-footer-nextpage" href="../fit/">Fitting. Measurements »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 20 April 2022 14:52">Wednesday 20 April 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
