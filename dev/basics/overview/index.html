<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Quick start · HetaSimulator Docs</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-149749027-1', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link rel="canonical" href="https://hetalang.github.io/HetaSimulator.jl/dev/basics/overview/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">HetaSimulator Docs</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Basics</span><ul><li class="is-active"><a class="tocitem" href>Quick start</a><ul class="internal"><li><a class="tocitem" href="#Writing-model-in-the-Heta-format"><span>Writing model in the Heta format</span></a></li><li><a class="tocitem" href="#Loading-platform-from-the-Heta-format"><span>Loading platform from the Heta format</span></a></li><li><a class="tocitem" href="#Creating-scenarios"><span>Creating scenarios</span></a></li><li><a class="tocitem" href="#Creating-measurements"><span>Creating measurements</span></a></li><li><a class="tocitem" href="#Solving-problems"><span>Solving problems</span></a></li></ul></li><li><a class="tocitem" href="../distributed/">Parallel simulations</a></li><li><a class="tocitem" href="../../table-formats/scenario/">Scenarios tables</a></li><li><a class="tocitem" href="../../table-formats/measurement/">Measurements tables</a></li><li><a class="tocitem" href="../../table-formats/parameters/">Parameters tables</a></li></ul></li><li><span class="tocitem">Tutorial</span><ul><li><a class="tocitem" href="../../tutorial/intro/">Introduction</a></li><li><a class="tocitem" href="../../tutorial/sim/">Scenario. Simulation</a></li><li><a class="tocitem" href="../../tutorial/mc/">Monte-Carlo. Statistics calculation</a></li><li><a class="tocitem" href="../../tutorial/fit/">Fitting. Measurements</a></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href>Quick start</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Quick start</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/hetalang/HetaSimulator.jl/blob/master/docs/src/basics/overview.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Quick-start"><a class="docs-heading-anchor" href="#Quick-start">Quick start</a><a id="Quick-start-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-start" title="Permalink"></a></h1><p>The general workflow for HetaSimulator is</p><ul><li>Writing a modeling platform in the Heta format</li><li>Loading platform into Julia environment</li><li>Creating model&#39;s settings and data adding scenarios and measurements</li><li>Solve problems using the methods: <code>sim</code>, <code>mc</code>, <code>fit</code></li><li>Analyze the results</li></ul><p>The particular workflow may be iterative, i.e. include updates to the model and re-simulation based on estimated parameters or model structure updates. It depend on the user&#39;s needs.</p><h2 id="Writing-model-in-the-Heta-format"><a class="docs-heading-anchor" href="#Writing-model-in-the-Heta-format">Writing model in the Heta format</a><a id="Writing-model-in-the-Heta-format-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-model-in-the-Heta-format" title="Permalink"></a></h2><p>Heta is a modeling language for quantitative systems pharmacology and systems biology. It is a DSL (domain-specific language) describing dynamic model or models in process-description format. Heta compiler converts it into variety of files including &quot;Julia&quot; format which can be loaded to Julia/HetaSimulator environment.</p><p>HetaSimulator supports all features of the <a href="https://hetalang.github.io/#/specifications/">Heta language</a>. So one can organize modeling project as re-used modules (files), include any number of models into single platform with the namespaces mechanism. The platform can use the declaration file <strong>platform.json</strong> or can be loaded from single file.  All Heta modules: Heta code, tables, SBML and JSON can be loaded as a modeling platform and compiled into ODE-based mathematical representation.</p><p>To read more about Heta-based modeling platforms and Heta compiler visit the homepage <a href="https://hetalang.github.io/#/">https://hetalang.github.io/#/</a>.</p><p>As an example we will use a model describing a simple pharmacokinetic model stored in single <strong>.heta</strong> file. It is expected that the model code will be placed into &quot;index.heta&quot; file located in a directory <strong>my_example</strong> or something like that.</p><pre><code class="language-julia">// Compartments
Vol0 @Compartment .= 1;
Vol1 @Compartment .= 6.3;
Vol2 @Compartment .= 10.6;

// Species
A0 @Species {compartment: Vol0, isAmount: true, output: true} .= 0;
C1 @Species {compartment: Vol1, output: true} .= 0;
C2 @Species {compartment: Vol2, output: true} .= 0;

// Reactions
v_abs @Reaction {actors: A0 = C1} := kabs * A0;
v_el @Reaction {actors: C1 =} := Vol1 * (kel * C1); // Vol1 * (kmax * C1 / (Km + C1));
v_distr @Reaction {actors: C1 = C2} := Q * (C1 - C2);

// Parameters
dose @Const = 20;
kabs @Const = 20;
kel @Const = 0.5;
Q @Const = 1.0;

// single dose event
sw1 @TimeSwitcher {start: 0};
A0 [sw1]= dose;

// multiple dose event, default off
sw2 @TimeSwitcher {start: 0, period: 24, active: false};
A0 [sw2]= dose;</code></pre><p>The model describes a typical two-compartment model with single or multiple dose depending on which event is active. Take a note that the component of the model is create without any <code>namespace</code> statement. This means they have the default namespace attribute <code>nameless</code>. This code is equivalent to the following system of ODE.</p><p class="math-container">\[\begin{aligned}
&amp;\frac{d}{dt}A_0 = - v_{abs}\\
&amp;\frac{d}{dt}(C_1 \cdot Vol_1) = v_{abs} - v_{el} - v_{distr}\\
&amp;\frac{d}{dt}(C_2 \cdot Vol_2) = v_{distr}\\
\\
&amp;A_0(0) = 0\\
&amp;C_1(0) = 0\\
&amp;C_2(0) = 0\\
&amp;v_{abs}(t) = kabs \cdot A_0\\
&amp;v_{el}(t) = Vol_1 \cdot (kel \cdot C_1)\\
&amp;v_{distr}(t) = Q \cdot (C_1 - C_2)\\
\end{aligned}\\
\\
\text{event at } t = 0\\
\\
A_0 = dose\]</p><p>Where parameters are</p><p class="math-container">\[\begin{aligned}
&amp;dose = 20\\
&amp;kabs = 10\\
&amp;kel = 0.2\\
&amp;Q  = 3.2\\
&amp;Vol_1 = 6.3\\
&amp;Vol_2 = 10.6\\
\end{aligned}\\\]</p><h2 id="Loading-platform-from-the-Heta-format"><a class="docs-heading-anchor" href="#Loading-platform-from-the-Heta-format">Loading platform from the Heta format</a><a id="Loading-platform-from-the-Heta-format-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-platform-from-the-Heta-format" title="Permalink"></a></h2><p>HetaSimulator loads modeling platform into <code>Platform</code> type object that is a container for all models simulation settings and experimental data. When you load a platform from Heta it includes only models converted from <code>concrete namespaces</code>. The scenario storage is empty and will be populated manually or imported from tables.</p><h3 id="Loading-with-internal-compiler"><a class="docs-heading-anchor" href="#Loading-with-internal-compiler">Loading with internal compiler</a><a id="Loading-with-internal-compiler-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-with-internal-compiler" title="Permalink"></a></h3><p>When <strong>HetaSimulator</strong> is installed and internal <strong>Heta compiler</strong> is installed the platform can be loaded with the method <a href="../../api/#HetaSimulator.load_platform-Tuple{AbstractString}"><code>load_platform</code></a>.</p><pre><code class="language-julia">using HetaSimulator, Plots

p = load_platform(&quot;./my_example&quot;)</code></pre><pre><code class="language-julia">No declaration file, running with defaults...
[info] Builder initialized in directory &quot;Y:\my_example&quot;.
[info] Compilation of module &quot;index.heta&quot; of type &quot;heta&quot;...
[info] Reading module of type &quot;heta&quot; from file &quot;Y:\my_example\index.heta&quot;...
[info] Setting references in elements, total length 50
[info] Checking for circular references in Records.
[warn] Units checking skipped. To turn it on set &quot;unitsCheck: true&quot; in declaration.
[info] Checking unit&#39;s terms.
[warn] &quot;Julia only&quot; mode
[info] Exporting to &quot;Y:\my_example\_julia&quot; of format &quot;Julia&quot;...
Compilation OK!
Loading platform... OK!

Platform with 1 model(s), 0 scenario(s), 0 measurement(s)
   Models: nameless
   Scenarios:    </code></pre><p>The first argument of <code>load_platform</code> declares the absolute or relative path to the platform directory. If you use another file name (not <strong>index.heta</strong>) you can declare it with <code>source</code> argument.</p><pre><code class="language-julia">p = load_platform(&quot;./my_example&quot;, source = &quot;another_name.heta&quot;)</code></pre><p>You can also load the model from another formats like SBML.</p><pre><code class="language-julia">p = load_platform(&quot;./another_project&quot;, source = &quot;model.xml&quot;, type = &quot;SBML&quot;)</code></pre><p>The list of additional arguments is approximately the same as <a href="https://hetalang.github.io/#/heta-compiler/cli-references?id=quotheta-buildquot-command">CLI options</a> of <code>heta build</code> command of Heta compilers. For the full list see <a href="../../api/#HetaSimulator.load_platform-Tuple{AbstractString}"><code>load_platform</code></a> references.</p><h3 id="Loading-pre-compiled-platform"><a class="docs-heading-anchor" href="#Loading-pre-compiled-platform">Loading pre-compiled platform</a><a id="Loading-pre-compiled-platform-1"></a><a class="docs-heading-anchor-permalink" href="#Loading-pre-compiled-platform" title="Permalink"></a></h3><p>Alternatively you can use files generated with stand-alone <a href="https://hetalang.github.io/#/heta-compiler/">Heta compiler</a>.</p><p>To do so the model code should be updated with the <code>#export</code> statement.</p><pre><code class="language-heta">...
sw2 @TimeSwitcher {start: 0, period: 24, active: false};
A0 [sw2]= dose;

#export {format: Julia, filepath: julia_platform};</code></pre><p>Running the code with the console command <code>heta build my_project</code> produces the file <strong>my_example/dist/julia_platform/model.jl</strong> which can be loaded with <a href="../../api/#HetaSimulator.load_jlplatform-Tuple{AbstractString}"><code>load_jlplatform</code></a> method.</p><pre><code class="language-julia">p = load_jlplatform(&quot;./my_example/dist/julia_platform/model.jl&quot;)</code></pre><pre><code class="language-julia">Loading platform... OK!
Platform with 1 model(s), 0 scenario(s), 0 measurement(s)
   Models: nameless
   Scenarios:   </code></pre><h2 id="Creating-scenarios"><a class="docs-heading-anchor" href="#Creating-scenarios">Creating scenarios</a><a id="Creating-scenarios-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-scenarios" title="Permalink"></a></h2><p><code>Scenario</code> in HetaSimulator is an object which stores a model together with additional settings and options. It sets the time point, ranges, updates parameter values, activate or inactivate events, etc.</p><p>The scenario-based approach is used to store pre-defined model&#39;s options: dose values, experimental scenarios, data saving options, initial values and others which can be applied for one or multiple models. The <code>Scenario</code> also stores <code>Measurement</code> points which is used for parameters identification and visualization.</p><p><code>Scenario</code> is created from default options passed from its model and user defined options from table row or set manually.</p><h3 id="Import-from-CSV-tables"><a class="docs-heading-anchor" href="#Import-from-CSV-tables">Import from CSV tables</a><a id="Import-from-CSV-tables-1"></a><a class="docs-heading-anchor-permalink" href="#Import-from-CSV-tables" title="Permalink"></a></h3><p>The most simple way to populate a platform by scenarios is to create a separate file with <code>Scenario</code> in <a href="../../table-formats/scenario/">tabular CSV format</a>.</p><p>Create file <strong>scenarios.csv</strong> file inside <strong>my_example</strong> with the following content.</p><table><tr><th style="text-align: right">id</th><th style="text-align: right">parameters.dose</th><th style="text-align: right">events_active.sw1</th><th style="text-align: right">events_active.sw2</th></tr><tr><td style="text-align: right">dose_1</td><td style="text-align: right">1</td><td style="text-align: right">true</td><td style="text-align: right">false</td></tr><tr><td style="text-align: right">dose_10</td><td style="text-align: right">10</td><td style="text-align: right">true</td><td style="text-align: right">false</td></tr><tr><td style="text-align: right">dose_100</td><td style="text-align: right">100</td><td style="text-align: right">true</td><td style="text-align: right">false</td></tr><tr><td style="text-align: right">multiple_15</td><td style="text-align: right">15</td><td style="text-align: right">false</td><td style="text-align: right">true</td></tr></table><p>The table can be loaded with the <a href="../../api/#HetaSimulator.read_scenarios"><code>read_scenarios</code></a> function.</p><pre><code class="language-julia">scn_df = read_scenarios(&quot;./my_example/scenarios.csv&quot;)</code></pre><pre><code class="language-julia">4×4 DataFrame
 Row │ id           parameters.dose  events_active.sw1  events_active.sw2 
     │ Symbol       Int64            Bool               Bool
─────┼────────────────────────────────────────────────────────────────────
   1 │ dose_1                     1               true              false
   2 │ dose_10                   10               true              false
   3 │ dose_100                 100               true              false
   4 │ multiple_15               15              false               true</code></pre><p>The function reads the content of CSV file, checks components and stores in <code>scn_df</code> variable of <code>DataFrame</code> format.</p><p>This should be loaded into <code>Platform</code> object.</p><pre><code class="language-julia">add_scenarios!(p, scn_df)</code></pre><p>As we can see all 4 scenarios from the table were added.</p><pre><code class="language-julia">p
Platform with 1 model(s), 4 scenario(s), 0 measurement(s)
   Models: nameless
   Scenarios: dose_1, dose_10, dose_100, multiple_15</code></pre><p>To get the particular scenario you can use the following syntax.</p><pre><code class="language-julia">scenario1 = scenarios(p)[:dose_1]
Scenario for tspan=(0.0, 48.0)
   Time range (tspan): (0.0, 48.0)
   Parameters: dose, kabs, kel, Q, sigma1, sigma2, sigma3
   Number of measurement points: 0</code></pre><p>See more about scenario tables in <a href="../../table-formats/scenario/">tabular CSV format</a>.</p><h3 id="Import-from-Excel-tables"><a class="docs-heading-anchor" href="#Import-from-Excel-tables">Import from Excel tables</a><a id="Import-from-Excel-tables-1"></a><a class="docs-heading-anchor-permalink" href="#Import-from-Excel-tables" title="Permalink"></a></h3><p>Instead of using CSV tables one can fill the XSLT file and load scenario table in the same manner.</p><pre><code class="language-julia">scn_df = read_scenarios(&quot;./my_example/scenarios.xlsx&quot;)</code></pre><pre><code class="language-julia">4×4 DataFrame
 Row │ id           parameters.dose  events_active.sw1  events_active.sw2 
     │ Symbol       Int64            Bool               Bool
─────┼────────────────────────────────────────────────────────────────────
   1 │ dose_1                     1               true              false
   2 │ dose_10                   10               true              false
   3 │ dose_100                 100               true              false
   4 │ multiple_15               15              false               true</code></pre><h3 id="Manual-creation"><a class="docs-heading-anchor" href="#Manual-creation">Manual creation</a><a id="Manual-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Manual-creation" title="Permalink"></a></h3><p><code>Scenario</code> objects can be created and loaded without any tables.</p><p>For example we need to create simulations with the default model </p><ul><li><code>dose = 100</code></li><li>event <code>sw2</code> is active </li><li>simulation time is from <code>0</code> to <code>1000</code></li><li>we need to observe all species: <code>A0</code>, <code>C1</code>, <code>C2</code>, and all reactions: <code>v_abs</code>, <code>v_el</code>, <code>v_distr</code></li></ul><p>Scenario can be created with the following code</p><pre><code class="language-julia"># to get the default model
model = models(p)[:nameless] 
# creating scenario
new_scenario = Scenario(
    model,
    (0.,1000.);
    parameters = [:dose=&gt;100.],
    events_active = [:sw1=&gt;false, :sw1=&gt;true],
    observables = [:A0, :C1, :C2, :v_abs, :v_el, :v_distr]
    ) </code></pre><pre><code class="language-none">Scenario for tspan=(0.0, 1000.0)
   Time range (tspan): (0.0, 1000.0)
   Parameters: dose, kabs, kel, Q, sigma1, sigma2, sigma3
   Number of measurement points: 0</code></pre><p>See more options in API docs for <a href="../../api/#HetaSimulator.Scenario"><code>Scenario</code></a> function.</p><p>To load it into <code>Platform</code> container use the following syntax.</p><pre><code class="language-julia">push!(scenarios(p), :multiple_100=&gt;new_scenario)</code></pre><p>where <code>multiple_100</code> is an identifier for the scenario in the dictionary.</p><h2 id="Creating-measurements"><a class="docs-heading-anchor" href="#Creating-measurements">Creating measurements</a><a id="Creating-measurements-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-measurements" title="Permalink"></a></h2><p><code>Measurement</code> in HetaSimulator is representation of experimentally measured value for parameter identification. Each <code>Measurement</code> is associated with some particular scenario, observable value and fixed time point.</p><p>All measurements in the platform are used to calculate the log-likelihood function when required. Measurements are stored inside <code>Scenario</code> objects.</p><h3 id="Import-from-CSV-tables-2"><a class="docs-heading-anchor" href="#Import-from-CSV-tables-2">Import from CSV tables</a><a class="docs-heading-anchor-permalink" href="#Import-from-CSV-tables-2" title="Permalink"></a></h3><p>User can load measurement points from one or several tables which follow <a href="basics/table-formats/measurement">table format</a>.</p><p>Create file <strong>measurements.csv</strong> file inside <strong>my_example</strong> with the following structure.</p><p>Full file can be downloaded from here: <a href="https://raw.githubusercontent.com/hetalang/hetasimulator/master/case/story_3/measurements.csv">measurements.csv</a></p><table><tr><th style="text-align: right">t</th><th style="text-align: right">measurement</th><th style="text-align: right">prob.mean</th><th style="text-align: right">prob.sigma</th><th style="text-align: right">scenario</th></tr><tr><td style="text-align: right">0.08333</td><td style="text-align: right">0.0686283</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.08333</td><td style="text-align: right">0.0684679</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.08333</td><td style="text-align: right">0.0726338</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.25</td><td style="text-align: right">0.119397</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.25</td><td style="text-align: right">0.137662</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.25</td><td style="text-align: right">0.120412</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">0.5</td><td style="text-align: right">0.131784</td><td style="text-align: right">C1</td><td style="text-align: right">sigma1</td><td style="text-align: right">dose_1</td></tr><tr><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td><td style="text-align: right">...</td></tr></table><p>The table can be loaded with the <a href="../../api/#HetaSimulator.read_measurements"><code>read_measurements</code></a> function.</p><pre><code class="language-julia">measurements_df = read_measurements(&quot;./cases/story_3/measurements.csv&quot;)
90×5 DataFrame
 Row │ t         measurement  prob.mean  prob.sigma  scenario 
     │ Float64   Float64      String     String      Symbol    
─────┼─────────────────────────────────────────────────────────
   1 │  0.08333    0.0686283  C1         sigma1      dose_1
   2 │  0.08333    0.0684679  C1         sigma1      dose_1
   3 │  0.08333    0.0726338  C1         sigma1      dose_1
   4 │  0.25       0.119397   C1         sigma1      dose_1
   5 │  0.25       0.137662   C1         sigma1      dose_1
  ⋮  │    ⋮           ⋮           ⋮          ⋮           ⋮
  87 │ 12.0        2.189      C1         sigma3      dose_100
  88 │ 24.0        0.877502   C1         sigma3      dose_100
  89 │ 24.0        1.036      C1         sigma3      dose_100
  90 │ 24.0        0.724612   C1         sigma3      dose_100
                                                81 rows omitted</code></pre><p>The function reads the content of CSV file, checks components and stores in <code>measurements_df</code> variable of <code>DataFrame</code> format.</p><p>To load measurements into <code>Platform</code> function <a href="../../api/#HetaSimulator.add_measurements!-Tuple{Platform, DataFrame}"><code>add_measurements!</code></a> can be used. The function converts all rows into a series of <code>Measurements</code> and associate them with scenario declared in <code>scenario</code> value.</p><pre><code class="language-julia">add_measurements!(p, measurements_df)</code></pre><h3 id="Import-from-Excel-tables-2"><a class="docs-heading-anchor" href="#Import-from-Excel-tables-2">Import from Excel tables</a><a class="docs-heading-anchor-permalink" href="#Import-from-Excel-tables-2" title="Permalink"></a></h3><p>Instead of using CSV tables one can fill the XSLT file and load measurements table in the same manner.</p><pre><code class="language-julia">measurements_df = read_measurements(&quot;./my_example/measurements.xlsx&quot;)</code></pre><h2 id="Solving-problems"><a class="docs-heading-anchor" href="#Solving-problems">Solving problems</a><a id="Solving-problems-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-problems" title="Permalink"></a></h2><p>There are three main problem types that can currently be solved with HetaSimulator:</p><ul><li><a href="#Simulation"><strong>Simulation</strong></a> of time-dependence for selected observables for one or several scenarios using <a href="../../api/#HetaSimulator.sim-Tuple{Platform}"><code>sim</code></a> method.</li><li><a href="#Monte-Carlo"><strong>Monte-Carlo</strong></a> type simulations that performs repeated simulations based on pre-set parameters distributions with <a href="../../api/#HetaSimulator.mc-Tuple{Union{Vector{Pair{Symbol, Scenario}}, Vector{Scenario}, Platform, Scenario}, DataFrame}"><code>mc</code></a> method.</li><li><a href="#Fitting"><strong>Fitting</strong></a> or parameter identification problem that optimizes values of selected model constants to reach the minimal discrepancy between simulations and experimental values which is solved by <a href="../../api/#HetaSimulator.fit-Tuple{Platform, Any}"><code>fit</code></a> method.</li></ul><p>Each method returns the solution of its specific type: <code>SimResult</code>, <code>MCResult</code> and <code>FitResult</code> or other types that include them.</p><p>The methods can be applied on different levels: <code>Platform</code>, <code>Scenario</code> or <code>Vector</code> of scenarios to allow applying all scenarios in the platform, some of them or the default one. Some important &quot;target vs method&quot; variants are shown in the next table.</p><table><tr><th style="text-align: right">Target</th><th style="text-align: right">Method</th><th style="text-align: right">Results</th><th style="text-align: right">Comments</th></tr><tr><td style="text-align: right"><code>Platform</code></td><td style="text-align: right"><code>sim</code></td><td style="text-align: right"><code>Vector{Pair{Symbol,SimResult}}</code></td><td style="text-align: right">All or selected list of scenarios in model will run</td></tr><tr><td style="text-align: right"><code>Scenario</code></td><td style="text-align: right"><code>sim</code></td><td style="text-align: right"><code>SimResult</code></td><td style="text-align: right">Only target scenario will run</td></tr><tr><td style="text-align: right"><code>Platform</code></td><td style="text-align: right"><code>mc</code></td><td style="text-align: right"><code>Vector{Pair{Symbol,MCResult}}</code></td><td style="text-align: right">All or selected list of scenarios in model will run multiple times.</td></tr><tr><td style="text-align: right"><code>Scenario</code></td><td style="text-align: right"><code>mc</code></td><td style="text-align: right"><code>MCResult</code></td><td style="text-align: right">Target scenario will run multiple times</td></tr><tr><td style="text-align: right"><code>Platform</code></td><td style="text-align: right"><code>fit</code></td><td style="text-align: right"><code>FitResult</code></td><td style="text-align: right">All or selected list of scenarios together their measurements will be used to optimize parameters.</td></tr></table><p><em>This page provides the example of applying methods on the <code>Platform</code> level only</em></p><p>See more information for each method in tutorials: <a href="../../tutorial/sim/">sim</a>, <a href="../../tutorial/mc/">mc explanations</a>, <a href="../../tutorial/fit/">fit explanations</a>.</p><h3 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h3><p>See more details about <code>sim</code> method in <a href="../../tutorial/sim/">sim method</a> tutorial.</p><p>On the previous steps we created the platform <code>p</code> and populated it with 4 scenarios and measurement points.</p><p>Without additional preparations we can simulate the platform which means running all 4 scenarios and combining all results into one object.</p><pre><code class="language-julia">res = sim(p)</code></pre><pre><code class="language-none">5-element Vector{Pair{Symbol, SimResult}}
    :dose_1 =&gt; 80x3 SimResult with status :Success.
    :dose_10 =&gt; 100x3 SimResult with status :Success.
    :dose_100 =&gt; 124x3 SimResult with status :Success.
    :multiple_15 =&gt; 668x3 SimResult with status :Success.
    :multiple_100 =&gt; 163x6 SimResult with status :Success.</code></pre><p>The whole solution consists of parts which corresponds to number of scenarios in Platform.</p><p>The results can be plotted using default <code>plot</code> method.</p><pre><code class="language-julia">plot(res)</code></pre><p><img src="../sim1.png" alt="sim1"/></p><p>The whole solution can also be translated into <code>DataFrame</code>.</p><pre><code class="language-julia">res_df = DataFrame(res)</code></pre><pre><code class="language-julia">1031×6 DataFrame
  Row │ t             A0            C1           C2           scope   scenario   
      │ Float64       Float64       Float64      Float64      Symbol  Symbol      
──────┼───────────────────────────────────────────────────────────────────────────
    1 │  0.0           0.0          0.0          0.0          ode_    multiple_15
    2 │  0.0          15.0          0.0          0.0          sw2     multiple_15
    3 │  3.33311e-6   14.999        0.000158714  2.49537e-11  ode_    multiple_15
    4 │  3.66642e-5   14.989        0.00174525   3.0187e-9    ode_    multiple_15
  ⋮   │      ⋮             ⋮             ⋮            ⋮         ⋮          ⋮
 1029 │ 45.1252       -3.9532e-26   0.0292381    0.108637     ode_    dose_100
 1030 │ 47.5238        3.29325e-27  0.0247767    0.0920607    ode_    dose_100
 1031 │ 48.0          -6.75365e-28  0.0239764    0.089087     ode_    dose_100
                                                                 1024 rows omitted</code></pre><p>User can work with the solution component by using indexing by component number, like here <code>res[1]</code> or by scenario id <code>res[:dose_1]</code>.</p><p>Any component can also be transformed into <code>DataFrame</code>.</p><pre><code class="language-julia">res_df1 = DataFrame(res[1])</code></pre><pre><code class="language-julia">702×6 DataFrame
 Row │ t              A0            C1           C2           scope   scenario   
     │ Float64        Float64       Float64      Float64      Symbol  Symbol      
─────┼────────────────────────────────────────────────────────────────────────────
   1 │   0.0           0.0          0.0          0.0          ode_    multiple_15
   2 │   0.0          15.0          0.0          0.0          sw2     multiple_15
   3 │   3.33311e-6   14.999        0.000158714  2.49537e-11  ode_    multiple_15
   4 │   3.66642e-5   14.989        0.00174525   3.0187e-9    ode_    multiple_15
  ⋮  │       ⋮             ⋮             ⋮            ⋮         ⋮          ⋮
 700 │ 168.0           2.79899e-18  0.0232934    0.0865488    ode_    multiple_15
 701 │ 168.0           2.79899e-18  0.0232934    0.0865488    ode_    multiple_15
 702 │ 168.0          15.0          0.0232934    0.0865488    sw2     multiple_15
                                                                  695 rows omitted</code></pre><p>The component can also be plotted.</p><pre><code class="language-julia">plot(res[1])</code></pre><p><img src="../sim2.png" alt="sim2"/></p><h3 id="Monte-Carlo"><a class="docs-heading-anchor" href="#Monte-Carlo">Monte-Carlo</a><a id="Monte-Carlo-1"></a><a class="docs-heading-anchor-permalink" href="#Monte-Carlo" title="Permalink"></a></h3><p>Monte-Carlo method runs simulation many times combining all simulations into single object <code>MCResult</code>. You should clarify here the distribution of random parameters and number of iterations.</p><pre><code class="language-julia">mc_res = mc(p, [:kabs=&gt;Normal(10.,1e-1), :kel=&gt;Normal(0.2,1e-3)], 1000)</code></pre><pre><code class="language-julia">5-element Vector{Pair{Symbol, MCResult}}
    :dose_1 =&gt; 1000x?x71 MCResult with status :Success x 1000
    :dose_10 =&gt; 1000x?x88 MCResult with status :Success x 1000
    :dose_100 =&gt; 1000x?x155 MCResult with status :Success x 1000
    :multiple_15 =&gt; 1000x?x583 MCResult with status :Success x 1000
    :multiple_100 =&gt; 1000x?x238 MCResult with status :Success x 1000</code></pre><p>To transform everything into <code>DataFrame</code></p><pre><code class="language-julia">mc_df = DataFrame(mc_res)</code></pre><pre><code class="language-julia">946000×7 DataFrame
    Row │ iter   t             A0           C1           C2           scope   scenario   
        │ Int64  Float64       Float64      Float64      Float64      Symbol  Symbol      
────────┼─────────────────────────────────────────────────────────────────────────────────
      1 │     1   0.0           0.0         0.0          0.0          ode_    multiple_15 
      2 │     1   0.0          15.0         0.0          0.0          sw2     multiple_15
      3 │     1   6.67001e-6   14.999       0.000158714  4.99357e-11  ode_    multiple_15
      4 │     1   7.33701e-5   14.989       0.00174525   6.04082e-9   ode_    multiple_15
      5 │     1   0.000740371  14.8894      0.0175505    6.13689e-7   ode_    multiple_15
      6 │     1   0.00602741   14.1231      0.139042     3.99353e-5   ode_    multiple_15
   ⋮    │   ⋮         ⋮             ⋮            ⋮            ⋮         ⋮          ⋮
 945996 │  1000  46.6664        4.55058e-7  0.247023     0.484307     ode_    dose_100
 945997 │  1000  47.0172        4.55058e-7  0.243049     0.476516     ode_    dose_100
 945998 │  1000  47.3681        4.55059e-7  0.239139     0.46885      ode_    dose_100
 945999 │  1000  47.719         4.55058e-7  0.235292     0.461307     ode_    dose_100
 946000 │  1000  48.0           1.28404e-7  0.232256     0.455355     ode_    dose_100
                                                                       945989 rows omitted</code></pre><p>To plot everything use <code>plot</code></p><pre><code class="language-julia">plot(mc_res)</code></pre><p><img src="../sim3.png" alt="fig3"/></p><h3 id="Fitting"><a class="docs-heading-anchor" href="#Fitting">Fitting</a><a id="Fitting-1"></a><a class="docs-heading-anchor-permalink" href="#Fitting" title="Permalink"></a></h3><p>To run optimization problem you need to do three steps:</p><ul><li>Be sure that you measurement points are loaded in a proper way: referred <code>Scenario</code>s exists, proper error model is chosen.</li><li>If required add parameters responsible for noise distribution into a model code, like <code>sigma</code> etc.</li><li>Select a set of constants which will be fitted and set initial values for them.</li></ul><p>For the presented example we uses normal distribution of measurement error with unknown variance parameter <code>sigma1</code>, <code>sigma2</code>, <code>sigma3</code> for doses 1, 10 and 100.</p><p>We need to add this unknown parameters into the Heta code updating the initial model:</p><pre><code class="language-heta">...
A0 [sw2]= dose;

// parameters for fitting
sigma1 @Const = 0.1;
sigma2 @Const = 0.1;
sigma3 @Const = 0.1;</code></pre><p>Take a note that the model compilation and loading <code>Scenario</code>s  and <code>Measurement</code>s should be repeated because <code>p</code> object was rebuild.</p><pre><code class="language-julia">p = load_platform(&quot;$HetaSimulatorDir/cases/story_3&quot;)

scn_df = read_scenarios(&quot;$HetaSimulatorDir/cases/story_3/scenarios.csv&quot;)
add_scenarios!(p, scn_df)

measurements_df = read_measurements(&quot;$HetaSimulatorDir/cases/story_3/measurements.csv&quot;)
add_measurements!(p, measurements_df)</code></pre><p>To check the initial simulated vs measured results the standard <code>plot</code> method can be used.</p><pre><code class="language-julia">res0 = sim(p)
plot(res0, yscale=:log, ylims=(1e-3,1e2))</code></pre><p><img src="../sim4.png" alt="sim4"/></p><p>Now let&#39;s run fitting.</p><pre><code class="language-julia">to_fit = [
    :kabs =&gt; 8.0,
    :Q =&gt; 4.0,
    :kel =&gt; 2.2,
    :sigma1 =&gt; 0.1,
    :sigma2 =&gt; 0.1,
    :sigma3 =&gt; 0.1,
]
fit_res = fit(p, to_fit)</code></pre><pre><code class="language-julia">FitResult with status :XTOL_REACHED
   Status: XTOL_REACHED
   Optimal values: [:kabs =&gt; 18.868605026704916, :Q =&gt; 4.043662480774219, :kel =&gt; 0.17104243648378176, :sigma1 =&gt; 0.020347955494158528, :sigma2 =&gt; 0.31561050699802246, :sigma3 =&gt; 0.5716026958426483]
   OF value: 140.96503722972034
   OF count: 8612</code></pre><p>To get the list of optimal parameters values we should use <code>optim</code> function.</p><pre><code class="language-julia">optim(fit_res)</code></pre><pre><code class="language-julia">6-element Vector{Pair{Symbol, Float64}}:
   :kabs =&gt; 18.868605026704916
      :Q =&gt; 4.043662480774219
    :kel =&gt; 0.17104243648378176
 :sigma1 =&gt; 0.020347955494158528        
 :sigma2 =&gt; 0.31561050699802246
 :sigma3 =&gt; 0.5716026958426483</code></pre><p>You can simulate and plot results with the following code.</p><pre><code class="language-julia">res_optim = sim(p, parameters = optim(fit_res))
plot(res_optim, yscale=:log, ylims=(1e-3,1e2))</code></pre><p><img src="../sim5.png" alt="sim5"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../distributed/">Parallel simulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 20 July 2023 21:58">Thursday 20 July 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
